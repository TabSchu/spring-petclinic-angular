name: Petclinc frontend CI/CD for develop

on:
  push:
    branches:
      - develop
  pull_request:
    branches:
      - develop

jobs:
  ci:
    runs-on: ubuntu-latest
   # container:
   #   image: node:14.15.1-alpine
    steps:
      - uses: actions/checkout@v2

      - name: build docker image
        run: docker build . -t  spring-petclinic-angular:latest
      - name: run container from docker image
        run: docker run -p 8080:8080 --detach --name petclinc-frontend-container spring-petclinic-angular:latest
      - name: Install Node.js/npm on Docker Image
        run: docker exec  petclinc-frontend-container  apk add --update npm
      - name: Install Dependencies with npm in docker container
        run: docker exec  petclinc-frontend-container npm install
      - name: install dependencies
        run: docker exec  petclinc-frontend-container apk --update add python3  make gcc g++ Xvfb
      - name: Run Unit-Tests (Karma)
        #run: docker exec -w /spring-petclinic-angular/ petclinc-frontend-container npm run test
        run:  docker exec  petclinc-frontend-container  npm run test
      - name: Run E2E-Tests(cypress)
    #    run: docker exec -w /spring-petclinic-angular/ petclinc-frontend-container npm run e2e
    #    run: docker exec -y petclinc-frontend-container  npm run e2e
        run: docker exec  petclinc-frontend-container npm run  cypress:run --browser chrome --headless
  cypress-run:
    runs-on: ubuntu-latest
    # Docker image with Cypress pre-installed
    # https://github.com/cypress-io/cypress-docker-images/tree/master/included
    container: cypress/included:3.8.3
    steps:
      - uses: actions/checkout@v2

      - name: install node/npm
        run: apt update && apt install npm
      - name: npm install
        run: npm install
  #    - name: build docker image
  #      run: docker build . -t  spring-petclinic-angular:latest
  #    - name: run container from docker image
  #      run: docker run -p 8080:8080 --detach --name petclinc-frontend-container spring-petclinic-angular:latest
      - run: cypress run --browser chrome --headless
#jobs:
#  ci:
#    runs-on: ubuntu-latest
#    container:
#      image: node:14.15.1-alpine
#
#    steps:
#      - uses: actions/checkout@v2
#      - name: Install
#        run: npm install
#      - name: Tests
#        run: npm test


